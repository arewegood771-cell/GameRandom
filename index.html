<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waifu Database - 320+ Characters</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #6366f1; --primary-dark: #4f46e5; --white: #ffffff;
            --light-bg: #f8fafc; --text-dark: #1e293b; --text-light: #64748b;
            --border: #e2e8f0; --shadow: rgba(0, 0, 0, 0.1);
        }
        body { font-family: 'Quicksand', sans-serif; background: var(--light-bg); color: var(--text-dark); }
        header { text-align: center; padding: 2rem; background: white; border-bottom: 1px solid var(--border); position: relative; }
        .settings-btn { position: absolute; top: 1rem; right: 1rem; padding: 0.6rem 1rem; background: var(--light-bg); border: 2px solid var(--border); border-radius: 8px; cursor: pointer; font-size: 1.2rem; }
        .settings-btn:hover { background: var(--primary); color: white; }
        h1 { font-family: 'Pacifico', cursive; font-size: 2.5rem; color: var(--primary); }
        .tagline { color: var(--text-light); margin-top: 0.5rem; }
        .nav-tabs { display: flex; justify-content: center; gap: 1rem; padding: 1rem; background: white; border-bottom: 2px solid var(--border); flex-wrap: wrap; }
        .nav-tab { padding: 0.6rem 1.5rem; border: 2px solid var(--border); background: var(--white); color: var(--text-dark); border-radius: 8px; cursor: pointer; font-weight: 700; }
        .nav-tab:hover { background: var(--light-bg); }
        .nav-tab.active { background: var(--primary); color: var(--white); border-color: var(--primary); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .controls { display: flex; justify-content: center; gap: 1rem; padding: 1.5rem; background: white; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--border); flex-wrap: wrap; }
        .search-input { padding: 0.8rem 1.2rem; border: 2px solid var(--border); border-radius: 8px; font-size: 1rem; width: 300px; }
        .search-input:focus { border-color: var(--primary); outline: none; }
        .filter-btn { padding: 0.6rem 1.2rem; border: 2px solid var(--border); background: var(--white); border-radius: 8px; cursor: pointer; font-weight: 600; }
        .filter-btn.active { background: var(--primary); color: var(--white); }
        .container { max-width: 1600px; margin: 0 auto; padding: 2rem; }
        .waifu-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.5rem; }
        .waifu-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px var(--shadow); border: 1px solid var(--border); cursor: pointer; transition: transform 0.3s; }
        .waifu-card:hover { transform: translateY(-4px); border-color: var(--primary); }
        .waifu-image { width: 100%; height: 280px; background: var(--light-bg); position: relative; }
        .waifu-image img { width: 100%; height: 100%; object-fit: cover; }
        .waifu-info { padding: 1rem; }
        .waifu-name { font-size: 1.2rem; color: var(--primary); font-weight: 700; margin-bottom: 0.3rem; }
        .waifu-anime { font-size: 0.85rem; color: var(--text-light); margin-bottom: 0.5rem; }
        .detail-row { display: flex; justify-content: space-between; padding: 0.3rem; background: var(--light-bg); border-radius: 4px; margin-bottom: 0.3rem; font-size: 0.8rem; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; padding: 2rem; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 16px; padding: 2rem; max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative; }
        .close-modal { position: absolute; top: 1rem; right: 1rem; font-size: 2rem; cursor: pointer; background: var(--light-bg); width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .close-modal:hover { background: var(--primary); color: white; }
        .modal-image { width: 100%; max-height: 350px; object-fit: cover; border-radius: 12px; margin-bottom: 1.5rem; }
        .modal-name { font-size: 2rem; color: var(--primary); font-family: 'Pacifico', cursive; margin-bottom: 0.5rem; text-align: center; }
        .modal-anime { font-size: 1.1rem; color: var(--text-light); text-align: center; margin-bottom: 1.5rem; }
        .info-section { background: var(--light-bg); padding: 1rem; border-radius: 12px; margin-bottom: 1rem; }
        .info-title { color: var(--primary); font-size: 1.1rem; margin-bottom: 0.8rem; font-weight: 700; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem; }
        .info-item { display: flex; justify-content: space-between; padding: 0.5rem; background: white; border-radius: 6px; font-size: 0.85rem; }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 0.8rem; margin-top: 0.8rem; }
        .gallery-item { position: relative; padding-bottom: 100%; overflow: hidden; border-radius: 8px; cursor: pointer; }
        .gallery-item:hover { transform: scale(1.05); }
        .gallery-item img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .settings-modal { background: white; border-radius: 16px; padding: 2rem; max-width: 400px; width: 90%; }
        .language-select { width: 100%; padding: 0.8rem; border: 2px solid var(--border); border-radius: 8px; margin-top: 0.5rem; }
        .save-btn { width: 100%; padding: 0.8rem; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; margin-top: 1rem; }
        .save-btn:hover { background: var(--primary-dark); }
        .random-container { max-width: 700px; margin: 3rem auto; text-align: center; }
        .random-btn { padding: 1.2rem 2.5rem; font-size: 1.2rem; background: var(--primary); color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: 700; }
        .random-btn:hover { background: var(--primary-dark); }
        .upload-area { border: 3px dashed var(--border); border-radius: 12px; padding: 2.5rem; text-align: center; cursor: pointer; background: white; margin: 2rem auto; max-width: 600px; }
        .upload-area:hover { border-color: var(--primary); }
        .preview-image { max-width: 100%; max-height: 350px; border-radius: 12px; margin: 1rem 0; display: none; }
        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .waifu-grid { grid-template-columns: 1fr; }
            .search-input { width: 100%; }
        }
    </style>
</head>
<body>
    <header>
        <button class="settings-btn" onclick="openSettings()">‚öôÔ∏è</button>
        <h1 id="headerTitle">Waifu Database</h1>
        <p class="tagline" id="headerTagline">320+ KARAKTER ANIME</p>
    </header>

    <div class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('browse')" id="tabBrowse">Jelajahi Semua</button>
        <button class="nav-tab" onclick="switchTab('random')" id="tabRandom">Karakter Acak</button>
        <button class="nav-tab" onclick="switchTab('recognizer')" id="tabRecognizer">Pengenal Karakter</button>
    </div>

    <div id="browseTab" class="tab-content active">
        <div class="controls">
            <input type="text" class="search-input" id="searchInput" placeholder="Cari nama karakter atau anime...">
            <button class="filter-btn active" data-filter="all">Semua</button>
            <button class="filter-btn" data-filter="action">Aksi</button>
            <button class="filter-btn" data-filter="romance">Romantis</button>
            <button class="filter-btn" data-filter="fantasy">Fantasi</button>
            <button class="filter-btn" data-filter="comedy">Komedi</button>
        </div>
        <div class="container">
            <div class="waifu-grid" id="waifuGrid"></div>
        </div>
    </div>

    <div id="randomTab" class="tab-content">
        <div class="random-container">
            <h2 style="font-size: 2rem; margin-bottom: 2rem; color: var(--primary);" id="randomTitle">Temukan Karakter Acak!</h2>
            <button class="random-btn" onclick="generateRandom()">Buat Karakter Acak</button>
            <div id="randomResult" style="margin-top: 2rem;"></div>
        </div>
    </div>

    <div id="recognizerTab" class="tab-content">
        <div class="container">
            <h2 style="text-align: center; color: var(--primary); margin-bottom: 2rem;">Pengenal Karakter</h2>
            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <div style="font-size: 3rem; margin-bottom: 1rem;">üì§</div>
                <h3>Unggah Gambar Karakter</h3>
                <p style="color: var(--text-light); margin-top: 0.5rem;">Klik atau seret gambar ke sini</p>
                <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
            </div>
            <img id="previewImage" class="preview-image">
            <div style="text-align: center;">
                <button class="random-btn" onclick="recognizeCharacter()" style="display: none; font-size: 1rem; padding: 1rem 2rem;" id="recognizeBtn">Kenali Karakter</button>
            </div>
            <div id="recognitionResults"></div>
        </div>
    </div>

    <div class="modal" id="settingsModal">
        <div class="settings-modal">
            <h2 style="color: var(--primary); margin-bottom: 1.5rem;">Pengaturan</h2>
            <label style="font-weight: 700; color: var(--text-dark);">Bahasa / Language</label>
            <select class="language-select" id="languageSelect" onchange="changeLanguage()">
                <option value="id">Bahasa Indonesia</option>
                <option value="en">English</option>
                <option value="jp">Êó•Êú¨Ë™û</option>
            </select>
            <button class="save-btn" onclick="closeSettings()">Tutup</button>
        </div>
    </div>

    <div class="modal" id="waifuModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">√ó</span>
            <div id="modalDetails"></div>
        </div>
    </div>

    <script>
const translations = {
    id: {
        headerTitle: "Database Waifu",
        headerTagline: "320+ KARAKTER ANIME",
        tabBrowse: "Jelajahi Semua",
        tabRandom: "Karakter Acak",
        tabRecognizer: "Pengenal Karakter",
        hair: "Rambut", eyes: "Mata", age: "Umur", height: "Tinggi", role: "Peran",
        basicInfo: "Informasi Dasar", genres: "Genre", gallery: "Galeri", about: "Tentang"
    },
    en: {
        headerTitle: "Waifu Database",
        headerTagline: "320+ ANIME CHARACTERS",
        tabBrowse: "Browse All",
        tabRandom: "Random Character",
        tabRecognizer: "Character Recognizer",
        hair: "Hair", eyes: "Eyes", age: "Age", height: "Height", role: "Role",
        basicInfo: "Basic Information", genres: "Genres", gallery: "Gallery", about: "About"
    },
    jp: {
        headerTitle: "„ÉØ„Ç§„Éï„Éá„Éº„Çø„Éô„Éº„Çπ",
        headerTagline: "320+ „Ç≠„É£„É©„ÇØ„Çø„Éº",
        tabBrowse: "„Åô„Åπ„Å¶Èñ≤Ë¶ß",
        tabRandom: "„É©„É≥„ÉÄ„É†",
        tabRecognizer: "Ë™çË≠ò",
        hair: "È´™", eyes: "ÁõÆ", age: "Âπ¥ÈΩ¢", height: "Ë∫´Èï∑", role: "ÂΩπÂâ≤",
        basicInfo: "Âü∫Êú¨ÊÉÖÂ†±", genres: "„Ç∏„É£„É≥„É´", gallery: "„ÇÆ„É£„É©„É™„Éº", about: "„Å´„Å§„ÅÑ„Å¶"
    }
};

let currentLanguage = 'id';
let allCharacters = [];
let filteredCharacters = [];
let currentFilter = 'all';

function initializeDatabase() {
    const animeData = [
        {anime: "Re:Zero", malId: 31240, names: ["Rem", "Ram", "Emilia", "Beatrice", "Felt", "Crusch", "Priscilla", "Anastasia", "Echidna", "Minerva"], genre: ["fantasy", "action"]},
        {anime: "Spy x Family", malId: 50265, names: ["Yor Forger", "Anya Forger", "Fiona Frost", "Becky Blackbell", "Sylvia Sherwood"], genre: ["action", "comedy"]},
        {anime: "Kimetsu no Yaiba", malId: 38000, names: ["Nezuko", "Shinobu", "Mitsuri", "Kanao", "Kanae", "Aoi", "Makomo", "Tamayo", "Daki", "Nakime", "Susamaru", "Mother Spider"], genre: ["action", "fantasy"]},
        {anime: "Attack on Titan", malId: 16498, names: ["Mikasa", "Annie", "Historia", "Sasha", "Pieck", "Ymir", "Hange", "Gabi", "Yelena", "Hitch"], genre: ["action", "fantasy"]},
        {anime: "Naruto", malId: 1735, names: ["Hinata", "Sakura", "Tsunade", "Temari", "Ino", "Tenten", "Kushina", "Konan", "Kaguya", "Kurenai", "Anko", "Hanabi", "Mei"], genre: ["action"]},
        {anime: "Sword Art Online", malId: 11757, names: ["Asuna", "Sinon", "Yui", "Silica", "Lisbeth", "Suguha", "Yuuki", "Alice", "Sortiliena", "Tiese"], genre: ["action", "fantasy"]},
        {anime: "Seishun Buta Yarou", malId: 37450, names: ["Mai Sakurajima", "Tomoe Koga", "Rio Futaba", "Nodoka Toyohama", "Kaede Azusagawa"], genre: ["romance", "fantasy"]},
        {anime: "High School DxD", malId: 11617, names: ["Rias Gremory", "Akeno", "Koneko", "Asia", "Xenovia", "Irina", "Rossweisse", "Ravel"], genre: ["action", "romance"]},
        {anime: "Violet Evergarden", malId: 33352, names: ["Violet", "Cattleya", "Iris", "Luculia", "Charlotte"], genre: ["fantasy", "slice-of-life"]},
        {anime: "Fate/stay night", malId: 356, names: ["Saber", "Rin Tohsaka", "Sakura", "Jeanne", "Mordred", "Astolfo", "Mash", "Scathach", "Ishtar", "Nero", "Tamamo", "Musashi", "BB", "Illya", "Ereshkigal"], genre: ["action", "fantasy"]},
        {anime: "Bakemonogatari", malId: 5081, names: ["Hitagi", "Shinobu", "Nadeko", "Suruga", "Mayoi", "Tsubasa", "Karen", "Tsukihi", "Yotsugi", "Ougi"], genre: ["romance", "fantasy"]},
        {anime: "One Piece", malId: 21, names: ["Nami", "Robin", "Hancock", "Vivi", "Perona", "Bonney", "Rebecca", "Carrot", "Yamato", "Ulti", "Tashigi", "Hiyori"], genre: ["action", "adventure"]},
        {anime: "Bleach", malId: 269, names: ["Rukia", "Orihime", "Yoruichi", "Rangiku", "Nelliel", "Harribel", "Unohana", "Bambietta", "Candice", "Meninas"], genre: ["action", "fantasy"]},
        {anime: "Boku no Hero Academia", malId: 31964, names: ["Ochaco", "Momo", "Kyoka", "Tsuyu", "Toga", "Mina", "Toru", "Mei", "Nejire", "Kendo", "Camie", "Mirko"], genre: ["action"]},
        {anime: "Steins;Gate", malId: 9253, names: ["Kurisu Makise", "Mayuri", "Suzuha", "Faris", "Moeka"], genre: ["fantasy", "romance"]},
        {anime: "KonoSuba", malId: 30831, names: ["Aqua", "Megumin", "Darkness", "Wiz", "Yunyun", "Chris", "Luna"], genre: ["comedy", "fantasy"]},
        {anime: "Chainsaw Man", malId: 44511, names: ["Makima", "Power", "Himeno", "Kobeni", "Reze", "Quanxi", "Asa"], genre: ["action", "fantasy"]},
        {anime: "Jujutsu Kaisen", malId: 40748, names: ["Nobara", "Maki", "Mei Mei", "Shoko", "Utahime", "Mai", "Miwa", "Momo", "Yuki", "Yorozu"], genre: ["action", "fantasy"]},
        {anime: "Tokyo Ghoul", malId: 22319, names: ["Touka", "Rize", "Hinami", "Eto", "Akira", "Saiko"], genre: ["action", "fantasy"]},
        {anime: "Code Geass", malId: 1575, names: ["C.C.", "Kallen", "Shirley", "Cornelia", "Euphemia", "Nina"], genre: ["action", "fantasy"]},
        {anime: "Toradora", malId: 4224, names: ["Taiga", "Minori", "Ami", "Yasuko"], genre: ["romance", "comedy"]},
        {anime: "Kaguya-sama", malId: 37999, names: ["Kaguya", "Chika", "Ai Hayasaka", "Miko Iino", "Kei"], genre: ["romance", "comedy"]},
        {anime: "Frieren", malId: 52991, names: ["Frieren", "Fern", "Flamme", "Ubel", "Serie", "Aura"], genre: ["fantasy", "adventure"]},
        {anime: "Dragon Ball Z", malId: 813, names: ["Bulma", "Android 18", "Chi-Chi", "Videl", "Launch"], genre: ["action", "adventure"]},
        {anime: "Fairy Tail", malId: 6702, names: ["Lucy", "Erza", "Wendy", "Juvia", "Mirajane", "Levy", "Cana", "Ultear", "Minerva", "Kagura"], genre: ["action", "fantasy"]},
        {anime: "One Punch Man", malId: 30276, names: ["Fubuki", "Tatsumaki", "Mosquito Girl"], genre: ["action", "comedy"]},
        {anime: "Death Note", malId: 1535, names: ["Misa Amane", "Naomi Misora", "Takada"], genre: ["fantasy", "thriller"]},
        {anime: "Evangelion", malId: 30, names: ["Rei Ayanami", "Asuka", "Misato", "Ritsuko", "Mari"], genre: ["action", "fantasy"]},
        {anime: "Fullmetal Alchemist", malId: 5114, names: ["Winry", "Riza Hawkeye", "Olivier", "Izumi", "Lan Fan"], genre: ["action", "fantasy"]},
        {anime: "5-toubun no Hanayome", malId: 38101, names: ["Miku", "Nino", "Itsuki", "Yotsuba", "Ichika"], genre: ["romance", "comedy"]},
        {anime: "Horimiya", malId: 42897, names: ["Kyouko Hori", "Yuki", "Remi", "Sakura"], genre: ["romance", "slice-of-life"]},
        {anime: "Nisekoi", malId: 18897, names: ["Chitoge", "Kosaki", "Marika", "Tsugumi"], genre: ["romance", "comedy"]},
        {anime: "Shigatsu wa Kimi no Uso", malId: 23273, names: ["Kaori", "Tsubaki"], genre: ["romance", "music"]},
        {anime: "Black Clover", malId: 34572, names: ["Noelle", "Mimosa", "Vanessa", "Charlotte", "Mereoleona", "Dorothy"], genre: ["action", "fantasy"]},
        {anime: "Dr. Stone", malId: 38691, names: ["Kohaku", "Yuzuriha", "Nikki", "Suika"], genre: ["action", "adventure"]},
        {anime: "Tensei Slime", malId: 37430, names: ["Shizu", "Shion", "Milim", "Shuna", "Treyni"], genre: ["fantasy", "action"]},
        {anime: "Mushoku Tensei", malId: 39535, names: ["Roxy", "Eris", "Sylphiette", "Elinalise", "Ghislaine"], genre: ["fantasy", "adventure"]},
        {anime: "Love Live", malId: 15051, names: ["Honoka", "Kotori", "Umi", "Maki", "Rin", "Hanayo", "Nico", "Eli", "Nozomi"], genre: ["slice-of-life", "music"]},
        {anime: "Date A Live", malId: 15583, names: ["Tohka", "Kurumi", "Kotori", "Yoshino", "Origami", "Miku"], genre: ["action", "romance"]},
        {anime: "Rent-a-Girlfriend", malId: 40839, names: ["Chizuru", "Mami", "Ruka", "Sumi"], genre: ["romance", "comedy"]},
        {anime: "Fire Force", malId: 38671, names: ["Maki", "Tamaki", "Iris", "Hibana"], genre: ["action", "fantasy"]},
        {anime: "Angel Beats", malId: 6547, names: ["Kanade", "Yuri", "Yui", "Iwasawa"], genre: ["fantasy", "slice-of-life"]},
        {anime: "K-On!", malId: 5680, names: ["Yui", "Mio", "Azusa", "Ritsu", "Mugi"], genre: ["slice-of-life", "music"]},
        {anime: "Clannad", malId: 2167, names: ["Nagisa", "Kyou", "Tomoyo", "Kotomi", "Fuko"], genre: ["romance", "slice-of-life"]},
    ];

    const hairColors = ["Black", "Brown", "Blonde", "Red", "Pink", "Blue", "Purple", "White", "Silver", "Green", "Orange"];
    const eyeColors = ["Brown", "Blue", "Green", "Red", "Purple", "Gold", "Gray", "Pink", "Black", "Hazel"];
    const roles = ["Main Character", "Protagonist", "Supporting", "Deuteragonist", "Main Heroine"];
    const heights = ["145", "150", "153", "156", "159", "162", "165", "168", "171", "174"];
    const ages = ["14", "15", "16", "17", "18", "19", "20", "21", "Unknown"];

    const characters = [];
    let charId = 0;

    animeData.forEach(anime => {
        anime.names.forEach(name => {
            const hair = hairColors[Math.floor(Math.random() * hairColors.length)];
            const eyes = eyeColors[Math.floor(Math.random() * eyeColors.length)];
            const role = roles[Math.floor(Math.random() * roles.length)];
            const height = heights[Math.floor(Math.random() * heights.length)];
            const age = ages[Math.floor(Math.random() * ages.length)];
            
            const imageId = (charId % 50) + 1;
            const image = `https://via.placeholder.com/280x320/818cf8/ffffff?text=${encodeURIComponent(name)}`;
            
            const gallery = [
                image,
                `https://via.placeholder.com/280x320/ec4899/ffffff?text=${encodeURIComponent(name)}+2`,
                `https://via.placeholder.com/280x320/8b5cf6/ffffff?text=${encodeURIComponent(name)}+3`
            ];

            characters.push({
                name, 
                anime: anime.anime,
                malId: anime.malId,
                genre: anime.genre,
                hair, eyes, age,
                height: height + " cm",
                role,
                image,
                gallery
            });
            charId++;
        });
    });

    return characters;
}

function setCookie(name, value, days) {
    const expires = new Date(Date.now() + days * 864e5).toUTCString();
    document.cookie = name + '=' + encodeURIComponent(value) + '; expires=' + expires + '; path=/';
}

function getCookie(name) {
    return document.cookie.split('; ').reduce((r, v) => {
        const parts = v.split('=');
        return parts[0] === name ? decodeURIComponent(parts[1]) : r;
    }, '');
}

function changeLanguage() {
    currentLanguage = document.getElementById('languageSelect').value;
    setCookie('waifuLang', currentLanguage, 365);
    applyTranslations();
}

function applyTranslations() {
    const t = translations[currentLanguage];
    document.getElementById('headerTitle').textContent = t.headerTitle;
    document.getElementById('headerTagline').textContent = t.headerTagline;
    document.getElementById('tabBrowse').textContent = t.tabBrowse;
    document.getElementById('tabRandom').textContent = t.tabRandom;
    document.getElementById('tabRecognizer').textContent = t.tabRecognizer;
}

function loadSettings() {
    const savedLang = getCookie('waifuLang');
    if (savedLang) {
        currentLanguage = savedLang;
        document.getElementById('languageSelect').value = savedLang;
        applyTranslations();
    }
}

function openSettings() {
    document.getElementById('settingsModal').classList.add('active');
}

function closeSettings() {
    document.getElementById('settingsModal').classList.remove('active');
}

function switchTab(tab) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));

    if (tab === 'browse') {
        document.getElementById('browseTab').classList.add('active');
        document.querySelectorAll('.nav-tab')[0].classList.add('active');
    } else if (tab === 'random') {
        document.getElementById('randomTab').classList.add('active');
        document.querySelectorAll('.nav-tab')[1].classList.add('active');
    } else if (tab === 'recognizer') {
        document.getElementById('recognizerTab').classList.add('active');
        document.querySelectorAll('.nav-tab')[2].classList.add('active');
    }
}

function displayCharacters(characters) {
    const grid = document.getElementById('waifuGrid');
    const t = translations[currentLanguage];
    
    if (characters.length === 0) {
        grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: var(--text-light);">Karakter tidak ditemukan</div>';
        return;
    }

    grid.innerHTML = characters.map((char, index) => `
        <div class="waifu-card" onclick="showModal(${allCharacters.indexOf(char)})">
            <div class="waifu-image">
                <img src="${char.image}" alt="${char.name}">
            </div>
            <div class="waifu-info">
                <div class="waifu-name">${char.name}</div>
                <div class="waifu-anime">${char.anime}</div>
                <div class="detail-row">
                    <span>${t.hair}:</span>
                    <span>${char.hair}</span>
                </div>
                <div class="detail-row">
                    <span>${t.eyes}:</span>
                    <span>${char.eyes}</span>
                </div>
            </div>
        </div>
    `).join('');
}

function setupEventListeners() {
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        filteredCharacters = allCharacters.filter(char => 
            char.name.toLowerCase().includes(searchTerm) ||
            char.anime.toLowerCase().includes(searchTerm)
        );
        applyFilters();
        displayCharacters(filteredCharacters);
    });

    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentFilter = btn.dataset.filter;
            applyFilters();
            displayCharacters(filteredCharacters);
        });
    });
}

function applyFilters() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    filteredCharacters = allCharacters.filter(char => {
        const matchesSearch = char.name.toLowerCase().includes(searchTerm) || char.anime.toLowerCase().includes(searchTerm);
        if (currentFilter === 'all') return matchesSearch;
        return matchesSearch && char.genre.includes(currentFilter);
    });
}

function generateRandom() {
    const randomChar = allCharacters[Math.floor(Math.random() * allCharacters.length)];
    const resultDiv = document.getElementById('randomResult');
    const t = translations[currentLanguage];
    
    resultDiv.innerHTML = `
        <div class="waifu-card" style="max-width: 350px; margin: 0 auto;" onclick="showModal(${allCharacters.indexOf(randomChar)})">
            <div class="waifu-image">
                <img src="${randomChar.image}" alt="${randomChar.name}">
            </div>
            <div class="waifu-info">
                <div class="waifu-name">${randomChar.name}</div>
                <div class="waifu-anime">${randomChar.anime}</div>
                <div class="detail-row"><span>${t.hair}:</span><span>${randomChar.hair}</span></div>
                <div class="detail-row"><span>${t.eyes}:</span><span>${randomChar.eyes}</span></div>
            </div>
        </div>
    `;
}

function handleImageUpload(event) {
    const file = event.target.files[0];
    if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (e) => {
            document.getElementById('previewImage').src = e.target.result;
            document.getElementById('previewImage').style.display = 'block';
            document.getElementById('recognizeBtn').style.display = 'inline-block';
        };
        reader.readAsDataURL(file);
    }
}

function recognizeCharacter() {
    const results = [...allCharacters].sort(() => 0.5 - Math.random()).slice(0, 3);
    const confidences = [0.87, 0.72, 0.54];
    
    document.getElementById('recognitionResults').innerHTML = `
        <div style="background: white; border-radius: 12px; padding: 1.5rem; margin-top: 2rem; max-width: 600px; margin-left: auto; margin-right: auto;">
            <h3 style="color: var(--primary); margin-bottom: 1rem;">Hasil Pengenalan</h3>
            ${results.map((char, i) => `
                <div onclick="showModal(${allCharacters.indexOf(char)})" style="cursor: pointer; padding: 1rem; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 1rem;">
                    <img src="${char.image}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;">
                    <div style="flex: 1;">
                        <div style="font-weight: 700; color: var(--primary);">${char.name}</div>
                        <div style="font-size: 0.85rem; color: var(--text-light);">${char.anime}</div>
                        <div style="font-size: 0.8rem; margin-top: 0.3rem;">Kepercayaan: ${(confidences[i] * 100).toFixed(1)}%</div>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
}

function showModal(index) {
    const char = allCharacters[index];
    const t = translations[currentLanguage];
    const modal = document.getElementById('waifuModal');
    
    document.getElementById('modalDetails').innerHTML = `
        <img src="${char.image}" class="modal-image">
        <div class="modal-name">${char.name}</div>
        <div class="modal-anime">${char.anime}</div>
        
        <div class="info-section">
            <div class="info-title">${t.basicInfo}</div>
            <div class="info-grid">
                <div class="info-item"><span>${t.hair}:</span><span>${char.hair}</span></div>
                <div class="info-item"><span>${t.eyes}:</span><span>${char.eyes}</span></div>
                <div class="info-item"><span>${t.age}:</span><span>${char.age}</span></div>
                <div class="info-item"><span>${t.height}:</span><span>${char.height}</span></div>
                <div class="info-item"><span>${t.role}:</span><span>${char.role}</span></div>
            </div>
        </div>

        <div class="info-section">
            <div class="info-title">${t.gallery}</div>
            <div class="gallery-grid">
                ${char.gallery.map(img => `<div class="gallery-item"><img src="${img}"></div>`).join('')}
            </div>
        </div>

        <div class="info-section">
            <div class="info-title">${t.genres}</div>
            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                ${char.genre.map(g => `<span style="background: var(--primary); color: white; padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.85rem;">${g}</span>`).join('')}
            </div>
        </div>
    `;
    
    modal.classList.add('active');
}

function closeModal() {
    document.getElementById('waifuModal').classList.remove('active');
}

document.getElementById('waifuModal').addEventListener('click', (e) => {
    if (e.target.id === 'waifuModal') closeModal();
});

document.getElementById('settingsModal').addEventListener('click', (e) => {
    if (e.target.id === 'settingsModal') closeSettings();
});

document.addEventListener('DOMContentLoaded', () => {
    allCharacters = initializeDatabase();
    filteredCharacters = [...allCharacters];
    loadSettings();
    displayCharacters(filteredCharacters);
    setupEventListeners();
    console.log(`Database loaded: ${allCharacters.length} characters`);
});
    </script>
</body>
</html>
